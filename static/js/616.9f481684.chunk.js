"use strict";(self.webpackChunkworld_map=self.webpackChunkworld_map||[]).push([[616],{6616:(e,t,r)=>{r.r(t),r.d(t,{default:()=>j});var n=r(5043),i=r(8128),l=r(2579),s=r(267),c=r(3969),o=r(6887),a=r(3182),u=r(5895),h=r(8065),d=r(9958),L=r(2169),p=r(3486),x=r(9934),E=r(9588),R=r(8368),f=r(9107),g=r(2749),C=r(3570),I=r(1491),A=r(5297),y=r(5362),w=r(8681),v=r(579);const m={BRUSH:"brush",ERASER:"eraser",LINE:"line",RECTANGLE:"rectangle",RECTANGLE_FILL:"rectangle_fill",CIRCLE:"circle",CIRCLE_FILL:"circle_fill",FILL:"fill"},b=(0,i.Ay)(l.A)((e=>{let{theme:t,selected:r}=e;return{color:r?t.palette.success.main:t.palette.text.primary,border:r?"2px solid ".concat(t.palette.success.main):"2px solid transparent","&:hover":{backgroundColor:t.palette.action.hover},marginRight:t.spacing(1)}}));const j=function(){const e=(0,s.A)(),t=(0,n.useRef)(null),r=(0,n.useRef)(null),i=(0,n.useRef)(!1),j=(0,n.useRef)({x:0,y:0}),[S,k]=(0,n.useState)(m.BRUSH),[T,_]=(0,n.useState)("#10b981"),[F,N]=(0,n.useState)("#10b981"),[G,M]=(0,n.useState)(8),D=(0,n.useRef)([]),z=(0,n.useRef)([]),P=()=>{const e=r.current;if(!e)return;const n=t.current,i=e.getImageData(0,0,n.width,n.height);D.current.push(i),D.current.length>50&&D.current.shift(),z.current=[]},U=()=>{const e=t.current;if(!e)return;const n=e.parentElement;if(!n)return;const i=window.devicePixelRatio||1,l=n.clientWidth,s=window.innerHeight-64-16;e.style.width=l+"px",e.style.height=s+"px",e.width=l*i,e.height=s*i;const c=e.getContext("2d");c.scale(i,i),c.lineCap="round",c.lineJoin="round",r.current=c,c.fillStyle="white",c.fillRect(0,0,l,s),P()};(0,n.useEffect)((()=>(U(),window.addEventListener("resize",U),()=>{window.removeEventListener("resize",U)})),[]),(0,n.useEffect)((()=>{if(!r.current)return;const e=r.current;e.strokeStyle=S===m.ERASER?"white":T,e.lineWidth=G}),[T,G,S]);const B=(e,t,r,n,i,l,s)=>{const c=Math.min(t.x,r.x),o=Math.min(t.y,r.y),a=Math.abs(t.x-r.x),u=Math.abs(t.y-r.y);e.lineWidth=l,s&&(e.fillStyle=i,e.fillRect(c,o,a,u)),e.strokeStyle=n,e.strokeRect(c,o,a,u)},W=(e,t,r,n,i,l,s)=>{const c=(t.x+r.x)/2,o=(t.y+r.y)/2,a=Math.abs(t.x-r.x)/2,u=Math.abs(t.y-r.y)/2,h=Math.min(a,u);e.lineWidth=l,e.beginPath(),e.ellipse(c,o,h,h,0,0,2*Math.PI),s&&(e.fillStyle=i,e.fill()),e.strokeStyle=n,e.stroke()},H=e=>{const r=t.current.getBoundingClientRect();let n,i;return e.touches&&e.touches.length?(n=e.touches[0].clientX,i=e.touches[0].clientY):(n=e.clientX,i=e.clientY),{x:n-r.left,y:i-r.top}},J=(0,n.useRef)(null),X=(0,n.useRef)(null);(0,n.useEffect)((()=>{const e=t.current;if(!e)return;const r=document.createElement("canvas");r.style.position="absolute",r.style.top=e.offsetTop+"px",r.style.left=e.offsetLeft+"px",r.style.pointerEvents="none",r.style.zIndex=10,r.width=e.width,r.height=e.height,r.style.width=e.style.width,r.style.height=e.style.height,e.parentElement.style.position="relative",e.parentElement.appendChild(r);const n=r.getContext("2d"),i=window.devicePixelRatio||1;return n.scale(i,i),n.lineCap="round",n.lineJoin="round",J.current=r,X.current=n,()=>{r.remove()}}),[]);const Y=()=>{if(!X.current)return;const e=X.current;e.clearRect(0,0,e.canvas.width,e.canvas.height)},O=(e,t)=>{if(!X.current)return;const r=X.current;switch(Y(),r.lineWidth=G,r.strokeStyle=T,r.fillStyle=F,S){case m.LINE:r.beginPath(),r.moveTo(e.x,e.y),r.lineTo(t.x,t.y),r.stroke();break;case m.RECTANGLE:B(r,e,t,T,F,G,!1);break;case m.RECTANGLE_FILL:B(r,e,t,T,F,G,!0);break;case m.CIRCLE:W(r,e,t,T,F,G,!1);break;case m.CIRCLE_FILL:W(r,e,t,T,F,G,!0)}},q=e=>{if(e.preventDefault(),!r.current)return;i.current=!0;const n=H(e);if(j.current=n,S===m.BRUSH||S===m.ERASER){P();const e=r.current;e.beginPath(),e.moveTo(n.x,n.y),e.strokeStyle=S===m.ERASER?"white":T,e.lineWidth=G,e.lineCap="round",e.lineJoin="round",e.lineTo(n.x,n.y),e.stroke()}else S===m.FILL?(P(),((e,t,r,n,i,l)=>{const s=e.getImageData(0,0,t,r),c=s.data,o=(e,r)=>4*(e*t+r),a=o(i,n),u=[c[a],c[a+1],c[a+2],c[a+3]],h=(e=>{let t=0,r=0,n=0,i=255;return 7===e.length?(t=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16)):9===e.length&&(t=parseInt(e.slice(1,3),16),r=parseInt(e.slice(3,5),16),n=parseInt(e.slice(5,7),16),i=parseInt(e.slice(7,9),16)),[t,r,n,i]})(l);if(u.every(((e,t)=>e===h[t])))return;const d=[[n,i]];for(;d.length;){const[e,n]=d.pop();if(e<0||e>=t||n<0||n>=r)continue;const i=o(n,e);[c[i],c[i+1],c[i+2],c[i+3]].every(((e,t)=>e===u[t]))&&(c[i]=h[0],c[i+1]=h[1],c[i+2]=h[2],c[i+3]=h[3],d.push([e+1,n],[e-1,n],[e,n+1],[e,n-1]))}e.putImageData(s,0,0)})(r.current,t.current.width,t.current.height,Math.floor(n.x),Math.floor(n.y),T),i.current=!1):S!==m.LINE&&S!==m.RECTANGLE&&S!==m.RECTANGLE_FILL&&S!==m.CIRCLE&&S!==m.CIRCLE_FILL||(P(),O(n,n))},K=e=>{if(e.preventDefault(),!i.current||!r.current)return;const t=H(e);if(S===m.BRUSH||S===m.ERASER){const e=r.current;e.lineTo(t.x,t.y),e.stroke()}else S!==m.LINE&&S!==m.RECTANGLE&&S!==m.RECTANGLE_FILL&&S!==m.CIRCLE&&S!==m.CIRCLE_FILL||O(j.current,t)},Q=e=>{if(e.preventDefault(),!i.current||!r.current)return;i.current=!1;const t=H(e),n=r.current;Y(),S===m.LINE?((e,t,r,n,i)=>{e.strokeStyle=n,e.lineWidth=i,e.beginPath(),e.moveTo(t.x,t.y),e.lineTo(r.x,r.y),e.stroke()})(n,j.current,t,T,G):S===m.RECTANGLE?B(n,j.current,t,T,F,G,!1):S===m.RECTANGLE_FILL?B(n,j.current,t,T,F,G,!0):S===m.CIRCLE?W(n,j.current,t,T,F,G,!1):S===m.CIRCLE_FILL&&W(n,j.current,t,T,F,G,!0)},V={[m.BRUSH]:(0,v.jsx)(L.A,{}),[m.ERASER]:(0,v.jsx)(p.A,{}),[m.LINE]:(0,v.jsx)(x.A,{}),[m.RECTANGLE]:(0,v.jsx)(E.A,{}),[m.RECTANGLE_FILL]:(0,v.jsx)(R.A,{}),[m.CIRCLE]:(0,v.jsx)(f.A,{}),[m.CIRCLE_FILL]:(0,v.jsx)(g.A,{}),[m.FILL]:(0,v.jsx)(C.A,{})};return(0,v.jsxs)(c.A,{sx:{height:"100vh",display:"flex",flexDirection:"column"},children:[(0,v.jsx)(o.A,{position:"static",children:(0,v.jsxs)(a.A,{variant:"dense",sx:{gap:1,flexWrap:"wrap"},children:[(0,v.jsx)(u.A,{variant:"h6",sx:{flexGrow:1},children:"React MS Paint"}),Object.entries(m).map((e=>{let[t,r]=e;return(0,v.jsx)(h.A,{title:r.charAt(0).toUpperCase()+r.slice(1).replace("_"," "),children:(0,v.jsx)(b,{selected:S===r,onClick:()=>k(r),"aria-pressed":S===r,color:"inherit",size:"large",children:V[r]})},r)})),(0,v.jsx)(h.A,{title:"Stroke Color",children:(0,v.jsx)("input",{type:"color","aria-label":"Select stroke color",style:{width:36,height:36,borderRadius:6,border:"none",cursor:"pointer",padding:0,marginLeft:8},value:T,onChange:e=>_(e.target.value)})}),(0,v.jsx)(h.A,{title:"Fill Color (for shapes)",children:(0,v.jsx)("input",{type:"color","aria-label":"Select fill color",style:{width:36,height:36,borderRadius:6,border:"none",cursor:S===m.RECTANGLE_FILL||S===m.CIRCLE_FILL?"pointer":"not-allowed",opacity:S===m.RECTANGLE_FILL||S===m.CIRCLE_FILL?1:.5,marginLeft:8},value:F,onChange:e=>N(e.target.value),disabled:!(S===m.RECTANGLE_FILL||S===m.CIRCLE_FILL)})}),(0,v.jsx)(h.A,{title:"Brush Size",children:(0,v.jsx)(c.A,{sx:{width:120,px:2},children:(0,v.jsx)(d.Ay,{"aria-label":"Brush size",value:G,min:1,max:50,onChange:(e,t)=>M(t),size:"small",sx:{color:e.palette.success.main}})})}),(0,v.jsx)(h.A,{title:"Undo",children:(0,v.jsx)(l.A,{onClick:()=>{const e=r.current,n=t.current;if(!e||0===D.current.length)return;const i=e.getImageData(0,0,n.width,n.height);z.current.push(i);const l=D.current.pop();e.putImageData(l,0,0)},color:"inherit","aria-label":"Undo",size:"large",children:(0,v.jsx)(I.A,{})})}),(0,v.jsx)(h.A,{title:"Redo",children:(0,v.jsx)(l.A,{onClick:()=>{const e=r.current,n=t.current;if(!e||0===z.current.length)return;const i=e.getImageData(0,0,n.width,n.height);D.current.push(i);const l=z.current.pop();e.putImageData(l,0,0)},color:"inherit","aria-label":"Redo",size:"large",children:(0,v.jsx)(A.A,{})})}),(0,v.jsx)(h.A,{title:"Clear",children:(0,v.jsx)(l.A,{onClick:()=>{const e=t.current,n=r.current;n&&(P(),n.clearRect(0,0,e.width,e.height),n.fillStyle="white",n.fillRect(0,0,e.width/(window.devicePixelRatio||1),e.height/(window.devicePixelRatio||1)))},color:"inherit","aria-label":"Clear canvas",size:"large",children:(0,v.jsx)(y.A,{})})}),(0,v.jsx)(h.A,{title:"Save as PNG",children:(0,v.jsx)(l.A,{onClick:()=>{const e=t.current.toDataURL("image/png"),r=document.createElement("a");r.href=e,r.download="react-ms-paint.png",r.click()},color:"inherit","aria-label":"Save image",size:"large",children:(0,v.jsx)(w.A,{})})})]})}),(0,v.jsx)(c.A,{sx:{flexGrow:1,position:"relative"},children:(0,v.jsx)("canvas",{ref:t,onMouseDown:q,onMouseMove:K,onMouseUp:Q,onMouseLeave:Q,onTouchStart:q,onTouchMove:K,onTouchEnd:Q,"aria-label":"Drawing canvas",tabIndex:0,style:{width:"100%",height:"100%",backgroundColor:"white",borderRadius:2,touchAction:"none",display:"block"}})})]})}}}]);
//# sourceMappingURL=616.9f481684.chunk.js.map